# Урок 5. Знакомство с FastAPI

## Classwork

### Теория:

##### Введение в FastAPI и его возможности

Framework FastAPI — это современный фреймворк для создания веб-приложений
на языке Python. Он был создан с учетом последних тенденций веб-разработки и
имеет ряд преимуществ перед другими фреймворками. FastAPI совсем новый
фреймворк, вышедший в 2018 году. С тех пор он активно развивается, набирает
популярность.
Основные возможности FastAPI
К основным возможностям FastAPI можно отнести следующие:
3
● Высокая скорость работы благодаря использованию асинхронных функций и
типизации данных.
● Автоматическая генерация документации API на основе аннотаций функций
и моделей данных.
● Встроенная валидация данных запросов и ответов.
● Поддержка OpenAPI и JSON Schema.
● Простота использования благодаря интуитивно понятному синтаксису и
многочисленным примерам.
Сравнение с другими фреймворками
FastAPI имеет ряд преимуществ перед другими популярными фреймворками,
такими как Flask и Django. Он более быстрый благодаря использованию
асинхронных функций, более безопасный благодаря встроенной валидации данных
и поддержке OpenAPI, а также более простой в использовании благодаря
интуитивно понятному синтаксису.
Настройка среды разработки
Рассмотрим процесс настройки среды разработки для работы с FastAPI.
Установка FastAPI
Первым шагом является установка FastAPI. Для этого необходимо использовать
менеджер пакетов pip, который уже устанавливается вместе с Python. Откройте
терминал и выполните следующую команду:
pip install fastapi
Эта команда установит FastAPI и все его зависимости.
Отдельно необходимо установить ASGI сервер для запуска приложения. Один из
вариантов — установка uvicorn.
pip install "uvicorn[standard]"
Настройка FastAPI
Для работы с FastAPI необходимо создать файл приложения и определить конечные
точки API. Для этого можно использовать любой текстовый редактор или
интегрированную среду разработки (IDE

#### Обработка HTTP-запросов и ответов

HTTP (Hypertext Transfer Protocol) — это протокол передачи данных в интернете,
используемый для обмена информацией между клиентом и сервером. В FastAPI
обработка HTTP-запросов и ответов происходит автоматически.
Основы протокола HTTP
Протокол HTTP работает по схеме "клиент-сервер". Клиент отправляет запрос на
сервер, а сервер отвечает на этот запрос. Запрос состоит из трех частей: метод,
адрес и версия протокола. Методы запроса могут быть GET, POST, PUT, DELETE и
другие. Адрес - это URL-адрес ресурса, к которому обращается клиент. Версия
протокола указывает на версию HTTP, которую использует клиент.

#### Валидация данных запроса и ответа

FastAPI позволяет автоматически валидировать данные запроса и ответа с
помощью модуля pydantic. Например, можно создать класс Item для валидации
данных:

#### Отправка запросов через curl

Если с GET запросом проблем не было, то для тестирования POST, PUT и DELETE запросов
воспользуемся curl.
Curl (client URL) — это инструмент командной строки на основе библиотеки libcurl для
передачи данных с сервера и на сервер при помощи различных протоколов, в том числе
HTTP, HTTPS, FTP, FTPS, IMAP, IMAPS, POP3, POP3S, SMTP и SMTPS. Он очень популярен в
сфере автоматизации и скриптов благодаря широкому диапазону функций и
поддерживаемых протоколов.
● POST запрос
Для отправки POST запроса нашему серверу введём в терминале следующую
строку:
curl -X 'POST' 'http://127.0.0.1:8000/items/' -H 'accept:
application/json' -H 'Content-Type: application/json' -d
'{"name": "BestSale", "description": "The best of the best",
"price": 9.99, "tax": 0.99}'
Эта строка отправляет POST запрос на URL-адрес «http://127.0.0.1:8000/items/» с
данными JSON, содержащими поля «имя», «описание», «цена» и «налог» вместе с
соответствующими значениями. Заголовки «accept» и «Content-Type» имеют
значение «application/json», мы пересылаем запросом json объект на сервер и хотим
получить json в качестве ответа.
● PUT запрос
Для отправки PUT запроса нашему серверу введём в терминале следующую строку:
curl -X 'PUT' 'http://127.0.0.1:8000/items/42' -H 'accept:
application/json' -H 'Content-Type: application/json' -d
'{"name": "NewName", "description": "New description of the
object", "price": 77.7, "tax": 10.01}'
12
Эта строка отправляет HTTP-запрос PUT на локальный сервер по адресу
http://127.0.0.1:8000/, обновляя элемент с идентификатором 42 новой
информацией, предоставленной в формате JSON, такой как имя, описание, цена и
налог.
Мы можем опускать необязательные поля объекта Item в запросе. Ответ от сервера
будет 200. А вот отсутствие обязательных параметров приведёт к ответу 422
Unprocessable Entity.
Хороший короткий PUT запрос:
curl -X 'PUT' 'http://127.0.0.1:8000/items/42' -H 'accept:
application/json' -H 'Content-Type: application/json' -d
'{"name": "NewName", "price": 77.7}'
Плохой PUT запрос:
curl -X 'PUT' 'http://127.0.0.1:8000/items/42' -H 'accept:
application/json' -H 'Content-Type: application/json' -d
'{"name": "NewName", "tax": 77.7}'
В данном запросе отсутствует обязательное поле price. Его мы сделали
обязательным в классе Item строкой price: float.
Код состояния ответа HTTP 422 Unprocessable Entity указывает, что сервер
понимает тип содержимого в теле запроса и синтаксис запроса является
правильным, но серверу не удалось обработать инструкции содержимого.
● DELETE запрос
Чтобы удалить объект нужен лишь его идентификатор, без передачи самого
объекта. curl будет выглядеть следующим образом:
curl -X 'DELETE' 'http://127.0.0.1:8000/items/13' -H 'accept:
application/json'
Запрос DELETE сообщает серверу о желании удалить объект с id 13.

#### Создание конечных точек API

FastAPI позволяет легко создавать конечные точки (endpoints) API для
взаимодействия с клиентами. Рассмотрим, как определять конечные точки,
работать с параметрами запроса и путями URL, а также форматировать ответы API.

#### Автоматическая документация по API

FastAPI обладает встроенным инструментом для автоматической документации
API, который позволяет быстро и удобно ознакомиться с функциональностью
приложения. Рассмотрим два варианта документации API: интерактивную
документацию Swagger и альтернативную документацию ReDoc.
Интерактивная документация Swagger
Swagger — это инструмент для создания и документирования API. FastAPI
использует Swagger UI для генерации интерактивной документации, которая
отображает все маршруты, параметры и модели данных, которые были определены
в приложении.
Для просмотра интерактивной документации Swagger нужно запустить приложение
и перейти по адресу http://localhost:8000/docs. На странице будут представлены все
маршруты и параметры, доступные в приложении.
